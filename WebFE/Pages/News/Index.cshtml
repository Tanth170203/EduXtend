@page
@{
    ViewData["Title"] = "News";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<div class="container py-4">
    <h2 class="mb-4">News</h2>
    <div id="newsList" class="row g-4"></div>
</div>

@section Scripts {
    <script>
        async function loadNews() {
            try {
                const res = await fetch(`${API_BASE_URL}/api/news?publishedOnly=true`, { credentials: 'include' });
                const items = res.ok ? await res.json() : [];
                const list = document.getElementById('newsList');
                list.innerHTML = items.length === 0 ? '<div class="text-muted">No news yet.</div>' : '';
                items.forEach(n => {
                    const col = document.createElement('div');
                    col.className = 'col-md-6 col-lg-4';
                    col.innerHTML = `
                        <div class="card h-100 shadow-sm border-0">
                            ${n.imageUrl ? `<div style="width:100%;max-width:100%;overflow:hidden;background:#f8f9fa;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;">
                                <img src="${n.imageUrl}" class="card-img-top" alt="${n.title}" style="width:100%;height:100%;object-fit:cover;object-position:center;display:block;" 
                                     onerror="this.onerror=null; this.src='/images/default-news.png'; this.style.objectFit='contain';">
                            </div>` : ''}
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${n.title}</h5>
                                <div class="mt-auto pt-3">
                                    <a class="btn btn-sm btn-primary" href="/News/Details?id=${n.id}">Read more</a>
                                </div>
                            </div>
                        </div>`;
                    list.appendChild(col);
                });
            } catch (e) {
                console.error(e);
            }
        }
        document.addEventListener('DOMContentLoaded', loadNews);
    </script>
}


